<html>
    <head>
        <meta charset="utf-8"/>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
                crossorigin="anonymous"></script>
        <!--    <script src="./js/client.js"></script>-->
        <!--    <script src="./js/manager.js"></script>-->

        <title>모두의 코딩</title>

        <!-- Code Mirror -->
        <link rel="stylesheet" href='/asset/css/code-mirror-style.css' />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.41.0/codemirror.min.js" ></script> 

        <!--        Highlighting -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.41.0/addon/runmode/colorize.js" ></script>
        <!--        Javascript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.41.0/mode/javascript/javascript.min.js" ></script>

        <!--        Python -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.41.0/mode/python/python.min.js" ></script>


        <link href='https://spoqa.github.io/spoqa-han-sans/css/SpoqaHanSans-kr.css' rel='stylesheet' type='text/css'>
        <link href='https://spoqa.github.io/spoqa-han-sans/css/SpoqaHanSans-jp.css' rel='stylesheet' type='text/css'>

        <link rel="stylesheet" href="/asset/css/bootstrap-theme.min.css">

        <link href="/asset/css/styles.css" rel="stylesheet" type='text/css'/>
    </head>

    <body>

        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" href="/">모두의 코딩</a>
                </div>
            </div>
        </nav>
       <div class="jumbotron">
           
       </div>
        <div class="container">
            <p id='send-state'></p>

            <h1>Client</h1>    

            <div id="wrapper-code">
                <div id="txt-code-client"></div>
            </div>

<!--            <button id='button'>보내기</button>-->

            <button id='btn_help' class="btn btn-danger">도움 요청</button>
            <button id='btn_submit' class="btn btn-success" >제출</button>
        </div>


    </body>

    <script>
        /* Socket.io 초기 설정 */
        $(function () {
            var socket = io();
            var sendStatus = document.getElementById('send-state');

            socket.on('connection', function (data) {
                sendStatus.innerHTML = data;

            });

            socket.on('newMessage', (data) => {
                sendStatus.innerHTML = data;
            });

            socket.on('somebodyHelp', (data) => {
                $("#txt-code-manager").addClass('helpped_client');
                $("#txt-code-manager").addClass('block_update');
                $("#txt-code-client textarea").attr("disabled", true);
            });    

            socket.on('somebodySubmit', (data) => {
                $("#txt-code-manager").addClass('submitted_client');
                $("#txt-code-manager").addClass('block_update');
                $("#txt-code-client textarea").attr("disabled", true);
            });

            /**
                *   제출, 완료
                */

            $('#btn_help').click(function() {
                // RestfulAPI or Socket
                socket.emit('help', "me")
            });

            $('#btn_submit').click(function() {
                // RestfulAPI or SOcket
                socket.emit('submit', "it")
            })

            /**
            *   Socket 관련 로직
            */
            function emitMessage(message) {
                socket.emit('message', message);
            }

            function emitCodeUpdate(code) {
                socket.emit('code', code);
            }

            /**
            *   코드 에디터 초기화.
            */

            myCodeMirror = CodeMirror(document.getElementById("txt-code-client") ,{
                lineNumbers: true,
                mode:  "python",
                showCursorWhenSelecting: false
            });
            myCodeMirror.setValue("");            

            /**
            *   코드 에디터 동작
            */
            $("#txt-code-client textarea").keyup(function() {
                /* Emmit */
                emitCodeUpdate(myCodeMirror.getValue());
            })
        })

    </script>

</html>