<html>
    <head>
        <meta charset="utf-8"/>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
                crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/color/jquery.color-2.1.2.min.js" integrity="sha256-H28SdxWrZ387Ldn0qogCzFiUDDxfPiNIyJX7BECQkDE=" crossorigin="anonymous"></script>
        <!--    <script src="./js/client.js"></script>-->
        <!--    <script src="./js/manager.js"></script>-->

        <!-- Code Mirror -->
        <link rel="stylesheet" href='css/code-mirror-style.css' />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.41.0/codemirror.min.js" ></script> 

        <!--        Highlighting -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.41.0/addon/runmode/colorize.js" ></script>
        <!--        Javascript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.41.0/mode/javascript/javascript.min.js" ></script>

        <!--        Python -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.41.0/mode/python/python.min.js" ></script>



        <link href='https://spoqa.github.io/spoqa-han-sans/css/SpoqaHanSans-kr.css' rel='stylesheet' type='text/css'>
        <link href='https://spoqa.github.io/spoqa-han-sans/css/SpoqaHanSans-jp.css' rel='stylesheet' type='text/css'>

        <link href="css/styles.css" rel="stylesheet" type='text/css'/>
    </head>

    <body>
        <p id='send-state'></p>

        <h1>Partner</h1>
        <div id="wrapper-code">
            <div id="txt-code-manager"></div>
        </div>

        <button id='button'>보내기</button>

        <div id="container-manager-control" style="display: none;">
            <button id='btn_success'>성공</button>
            <button id='btn_failure'>실패</button>    
        </div>

    </body>

    <script>

        /**
            *   코드 에디터 초기화.
            */
        partnerCodeMirror = CodeMirror(document.getElementById("txt-code-manager"), {
            lineNumbers: true,
            mode:  "python",
            showCursorWhenSelecting: false
        });

        /**
            *   코드 에디터 동작
            */
        $("#txt-code-manager textarea").keyup(function() {
            /* Emit */
            //                emitCodeUpdate(myCodeMirror.getValue());
        })


        /* Socket.io 초기 설정 */
        $(function () {
            var socket = io();
            var sendStatus = document.getElementById('send-state');

            socket.on('connection', function (data) {
                sendStatus.innerHTML = data;

            });

            socket.on('newMessage', (data) => {
                sendStatus.innerHTML = data;
            });

            socket.on('codeUpdate', (data) => {
                $codeEidtor = $("#wrapper-code");
                partnerCodeMirror.setValue(data);

                $codeEidtor.removeClass('helpped_client');
                $codeEidtor.removeClass('submitted_client');
                
                $codeEidtor.css({backgroundColor: "#FFFF0050"});
                $codeEidtor.stop().animate({ backgroundColor: "#FFFFFF" }, 500);    
            });

            socket.on('somebodyHelp', (data) => {
                $("#wrapper-code").addClass('helpped_client');
                $codeEidtor.css({backgroundColor: "red"});
            });    

            socket.on('somebodySubmit', (data) => {
                $("#wrapper-code").addClass('submitted_client');
                $codeEidtor.css({backgroundColor: "blue"});
            });

            /**
            *   Socket 관련 로직
            */
            function emitMessage(message) {
                socket.emit('message', message);
            }

            function emitCodeUpdate(code) {
                socket.emit('code', code);
            }
        })

    </script>

</html>